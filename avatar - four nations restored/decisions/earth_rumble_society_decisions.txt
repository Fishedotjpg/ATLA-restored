###########################################
#
# Society decisions for Earth Rumble League
#
###########################################

society_decisions = {

	earth_rumble_gimmick_decision = {
		ai_check_interval = 24
		is_high_prio = yes
		
		potential = {
			society_member_of = earth_rumble
			has_quest = quest_erb_gimmick
			NOT = { has_character_flag = earth_gimmick_timer }
		}

		allow = {
			has_quest = quest_erb_gimmick
			custom_tooltip = {
				text = earth_rumble_gimmick_allow_tt
				OR = {
					NOT = { has_character_flag = earth_gimmick_timer }
					had_character_flag = { flag = earth_gimmick_timer days = 120 }
				}
			}
			custom_tooltip = {
				text = erb_gimmick_cooldown_tt
				hidden_trigger = {
					NOT = {
						has_character_modifier = erb_working_with_promoter
					}
				}
			}
		}

		effect = {
			add_character_modifier = {
				name = erb_working_with_promoter
				duration = -1
			}
			hidden_effect = { character_event = { id = ERB.5003 } }
		}

		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1

			modifier = {
				factor = 0.01
				war = yes
			}
			modifier = {
				factor = 2
				OR = {
					trait = gregarious
					trait = ambitious
				}
			}
			modifier = {
				factor = 2
				OR = {
					trait = strong
					trait = robust
				}
			}
			modifier = {
				factor = 4
				OR = {
					trait = misguided_warrior
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
				}
			}
			modifier = {
				factor = 5
				martial = 20
			}
			modifier = {
				factor = 3
				martial = 12
			}
		}
	}
	
	monastic_order_rejoin_world = {
		ai_check_interval = 24

		potential = {
			has_character_modifier = erb_working_with_promoter
		}

		allow = {
			has_character_modifier = erb_working_with_promoter
		}

		effect = {
			remove_character_modifier = erb_working_with_promoter
			hidden_effect = {
				clr_character_flag = success_seculison_desc_A #Flags from 4426
				clr_character_flag = success_seculison_desc_B
				clr_character_flag = success_seculison_desc_C
			}
		}

		revoke_allowed = { always = no }

		ai_will_do = {
			factor = 0
		}
	}
}

targetted_decisions = {

	erb_learn_bending = {
		ai_check_interval = 12
		is_in_society = yes
		
		potential = {
			NOT = { trait = incapable }
			society_rank >= 2
			is_in_society = yes
			trait = earthbender
			is_adult = yes
			OR = {
				trait = master_bender
				trait = legendary_bender
				trait = powerful_bender
			}
		}
		
		from_potential = {
			society_rank >= 1
			society_member_of = earth_rumble
			NOT = {
				age = 16
				has_character_flag = erb_trained_in_bending
			}
			NOT= {
				trait = master_bender
				trait = legendary_bender
				trait = powerful_bender
			}
			NOT = { trait = incapable }
		}
		
		allow = {
			FROM = {
				has_society_currency_minor_trigger = yes	###requires 100SocCur
				is_inaccessible_trigger = no
				prisoner = no
				in_command = no
			}
			is_inaccessible_trigger = no
			prisoner = no
			in_command = no
		}
		
		effect = {
			FROM = {
				detract_society_currency_minor_effect = yes	###lose 100SocCur
				if = {
					limit = {
						trait = competent_bender
					}
					remove_trait = competent_bender 
					add_trait = powerful_bender
				}
				if = {
					limit = {
						trait = incompetent_bender
					}
					remove_trait = incompetent_bender 
					add_trait = competent_bender
				}
				hidden_tooltip = {
					character_event = { id = ERB.5065 } 
				}
				set_character_flag = erb_trained_in_bending
			}
			ROOT = {
				hidden_tooltip = {
					character_event = { id = ERB.5064 } 
				}
			}
		}
		
		ai_will_do = {
			factor = 750
		}
	}
	
	erb_teach_healing = {
		ai_check_interval = 12
		is_in_society = yes
		
		potential = {
			NOT = { trait = incapable }
			is_in_society = yes
			trait = waterbender
			NOR = { 
				trait = healer
				trait = master_healer
			}
		}
		
		from_potential = {
			society_rank >= 1
			society_member_of = earth_rumble
			is_adult = yes
			OR = {
				trait = healer
				trait = master_healer
			}
			NOT = { trait = incapable }
		}
		
		allow = {
			FROM = {
				has_society_currency_minor_trigger = yes	###requires 100SocCur
				is_inaccessible_trigger = no
				prisoner = no
				in_command = no
			}
			is_inaccessible_trigger = no
			prisoner = no
		}
		
		revoke_allowed = {
			always = no
		}
		
		effect = {
			FROM = {
				detract_society_currency_minor_effect = yes	###lose 100SocCur
				hidden_tooltip = {
					character_event = { id = MNerb.5064 } 
				}
			}
			ROOT = {
				add_trait = healer
				if = {
					limit = {
						trait = competent_bender
					}
					remove_trait = competent_bender 
					add_trait = powerful_bender
				}
				if = {
					limit = {
						trait = incompetent_bender
					}
					remove_trait = incompetent_bender 
					add_trait = competent_bender
				}
				hidden_tooltip = {
					character_event = { id = MNerb.5065 } 
				}
			}
			add_taught_healing = yes
		}
		
		ai_will_do = {
			factor = 1000
		}
	}
	
	erb_recruit_member = {
		ai_check_interval = 12
		filter = realm
		ai_target_filter = home_court
		is_in_society = yes
			
		potential = {
			NOT = { trait = incapable }
			is_in_society = no
			age = 10
			trait = waterbender
			OR = {
				religion = tui_and_la
				religion = tui_and_la_reformed
			}
			NAND = {
				is_female = no
				NOT = { has_law = status_of_women_4 }
			}
		}
		
		from_potential = {
			society_rank >= 2
			society_member_of = earth_rumble
			is_adult = yes
			trait = healer
			NOT = { trait = incapable }
		}
		
		allow = {
			FROM = {
				has_society_currency_medium_trigger = yes	###requires 300SocCur
				is_inaccessible_trigger = no
				prisoner = no
				in_command = no
			}
			is_inaccessible_trigger = no
			prisoner = no
		}
		
		revoke_allowed = {
			always = no
		}
		
		effect = {
			FROM = {
				detract_society_currency_medium_effect = yes	###lose 300SocCur
			}
			ROOT = {
				hidden_tooltip = {
					letter_event = { id = MNerb.5061 } 
				}
			}
		}
		
		ai_will_do = {
			factor = 1000
		}
	}
}